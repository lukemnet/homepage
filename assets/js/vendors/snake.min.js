/*
JavaScript Snake
Original author: Patrick Gillespie  + contributors - http://patorjk.com/games/snake
Modifications by Łukasz Wójcik - https://www.lukem.net
*/
var SNAKE=SNAKE||{};SNAKE.addEventListener=function(e,t,n,a){e.addEventListener(t,n,a)},SNAKE.removeEventListener=function(e,t,n,a){e.removeEventListener(t,n,a)},SNAKE.Snake=SNAKE.Snake||function(){function B(){this.elm=null,this.elmStyle=null,this.row=-1,this.col=-1,this.xPos=-1e3,this.yPos=-1e3,this.next=null,this.prev=null}var w=[];return function(o){var l,d,a,i,s,n,r,c,u,h,k,p,y,g,m,e;function f(){var e=document.createElement("div");return e.className="snake-snakebody-block",e.style.left="-1000px",e.style.top="-1000px",e.style.width=d.getBlockWidth()+"px",e.style.height=d.getBlockHeight()+"px",e}function v(e){for(var t,n=f(),a=1;a<e;a++)(t=new B).elm=n.cloneNode(!0),t.elmStyle=t.elm.style,d.getBoardContainer().appendChild(t.elm),w[w.length]=t;(t=new B).elm=n,d.getBoardContainer().appendChild(t.elm),w[w.length]=t}function t(e){l.snakeHead.elm.style.zIndex=function(e){var t,n=0,a=0;for(t in e)e[t].elm.currentStyle?a=parseFloat(e[t].elm.style["z-index"],10):window.getComputedStyle&&(a=parseFloat(document.defaultView.getComputedStyle(e[t].elm,null).getPropertyValue("z-index"),10)),!isNaN(a)&&n<a&&(n=a);return n+1}(l.snakeBody),l.snakeHead.elm.className=l.snakeHead.elm.className.replace(/\bsnake-snakebody-alive\b/,""),l.snakeHead.elm.className+=" snake-snakebody-dead",m=!0,e()}o&&o.playingBoard&&(l=this,d=o.playingBoard,n=s=!0,c=[0,a=1,0,r=i=-1],u=[-1,0,1,0],h=[],k=[],y=p=null,m=!(g=80),(e=document.getElementById("selectMode"))&&e.addEventListener("change",function(e){var t=(e=e||{}).target?parseInt(e.target.value):75;(isNaN(t)||t<50)&&(t=75),g=t,setTimeout(function(){document.getElementById("game-area").focus()},10)}),l.snakeBody={},l.snakeBody.b0=new B,l.snakeBody.b0.row=o.startRow||1,l.snakeBody.b0.col=o.startCol||1,l.snakeBody.b0.xPos=l.snakeBody.b0.row*d.getBlockWidth(),l.snakeBody.b0.yPos=l.snakeBody.b0.col*d.getBlockHeight(),l.snakeBody.b0.elm=f(),l.snakeBody.b0.elmStyle=l.snakeBody.b0.elm.style,d.getBoardContainer().appendChild(l.snakeBody.b0.elm),l.snakeBody.b0.elm.style.left=l.snakeBody.b0.xPos+"px",l.snakeBody.b0.elm.style.top=l.snakeBody.b0.yPos+"px",l.snakeBody.b0.next=l.snakeBody.b0,l.snakeBody.b0.prev=l.snakeBody.b0,l.snakeLength=1,l.snakeHead=l.snakeBody.b0,l.snakeTail=l.snakeBody.b0,l.snakeHead.elm.className=l.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),l.snakeHead.elm.className+=" snake-snakebody-alive",l.handleArrowKeys=function(e){if(!m){var t=-1;switch(e){case 37:case 65:t=3;break;case 38:case 87:t=0;break;case 39:case 68:t=1;break;case 40:case 83:t=2}r!==a&&(i=t),(2!==Math.abs(t-a)&&s||n)&&(r=t,n=s=!1)}},l.handleTouchstart=function(e){var t=e.touches[0];p=t.clientX,y=t.clientY},l.handleTouchmove=function(e){var t,n,a,o;m||p&&y&&(t=e.touches[0].clientX,n=e.touches[0].clientY,a=p-t,o=y-n,Math.abs(a)>Math.abs(o)?0<a?l.handleArrowKeys(37):l.handleArrowKeys(39):0<o?l.handleArrowKeys(38):l.handleArrowKeys(40),y=p=null)},l.go=function(){var e=l.snakeHead,t=l.snakeTail,n=d.grid;if(l.snakeTail=t.prev,n[(l.snakeHead=t).row]&&n[t.row][t.col]&&(n[t.row][t.col]=0),-1!==r&&(a=r,-1!==i&&(r=i,i=-1)),s=!0,t.col=e.col+c[a],t.row=e.row+u[a],t.xPos=e.xPos+h[a],t.yPos=e.yPos+k[a],t.elmStyle||(t.elmStyle=t.elm.style),t.elmStyle.left=t.xPos+"px",t.elmStyle.top=t.yPos+"px",0===n[t.row][t.col])n[t.row][t.col]=1,setTimeout(function(){l.go()},g);else if(0<n[t.row][t.col])l.handleDeath();else if(n[t.row][t.col]===d.getGridFoodValue()){if(n[t.row][t.col]=1,!l.eatFood())return void l.handleWin();setTimeout(function(){l.go()},g)}},l.eatFood=function(){w.length<=1&&v(2);for(var e,t=w.splice(0,1),n=t.length,a=l.snakeTail;n--;)e="b"+l.snakeLength++,l.snakeBody[e]=t[n],l.snakeBody[e].prev=a,l.snakeBody[e].elm.className=l.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),l.snakeBody[e].elm.className+=" snake-snakebody-alive",a.next=l.snakeBody[e],a=l.snakeBody[e];return l.snakeTail=l.snakeBody[e],l.snakeTail.next=l.snakeHead,l.snakeHead.prev=l.snakeTail,!!d.foodEaten()},l.handleDeath=function(){t(d.handleDeath)},l.handleWin=function(){t(d.handleWin)},l.rebirth=function(){n=s=!(m=!1),i=-1},l.reset=function(){if(!1!==m){for(var e,t=[],n=l.snakeHead.next;n!==l.snakeHead;)e=n.next,n.prev=null,n.next=null,t.push(n),n=e;l.snakeHead.next=l.snakeHead,l.snakeHead.prev=l.snakeHead,l.snakeTail=l.snakeHead;for(var a=l.snakeLength=0;a<t.length;a++)t[a].elm.style.left="-1000px",t[a].elm.style.top="-1000px",t[a].elm.className=l.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),t[a].elm.className+=" snake-snakebody-alive";w.concat(t),l.snakeHead.elm.className=l.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),l.snakeHead.elm.className+=" snake-snakebody-alive",l.snakeHead.row=o.startRow||1,l.snakeHead.col=o.startCol||1,l.snakeHead.xPos=l.snakeHead.row*d.getBlockWidth(),l.snakeHead.yPos=l.snakeHead.col*d.getBlockHeight(),l.snakeHead.elm.style.left=l.snakeHead.xPos+"px",l.snakeHead.elm.style.top=l.snakeHead.yPos+"px"}},v(2),h[0]=0,h[1]=d.getBlockWidth(),h[2]=0,h[3]=-1*d.getBlockWidth(),k[0]=-1*d.getBlockHeight(),k[1]=0,k[2]=d.getBlockHeight(),k[3]=0)}}(),SNAKE.Food=SNAKE.Food||function(){var n=0;function r(e,t){return Math.floor(Math.random()*(t+1-e))+e}return function(e){var l,d,i,t,s;e&&e.playingBoard&&(l=e.playingBoard,t=n++,(s=document.createElement("div")).setAttribute("id","snake-food-"+t),s.className="snake-food-block",s.style.width=l.getBlockWidth()+"px",s.style.height=l.getBlockHeight()+"px",s.style.left="-1000px",s.style.top="-1000px",l.getBoardContainer().appendChild(s),this.getFoodElement=function(){return s},this.randomlyPlaceFood=function(){l.grid[d]&&l.grid[d][i]===l.getGridFoodValue()&&(l.grid[d][i]=0);for(var e=0,t=0,n=0,a=l.grid.length-1,o=l.grid[0].length-1;0!==l.grid[e][t];)if(e=r(1,a),t=r(1,o),2e4<++n)return!1;return l.grid[e][t]=l.getGridFoodValue(),d=e,i=t,s.style.top=e*l.getBlockHeight()+"px",s.style.left=t*l.getBlockWidth()+"px",!0})}}(),SNAKE.Board=SNAKE.Board||function(){var d=0;function r(e){var t,n=0,a=0;for(t in e)e[t].elm.currentStyle?a=parseFloat(e[t].elm.style["z-index"],10):window.getComputedStyle&&(a=parseFloat(document.defaultView.getComputedStyle(e[t].elm,null).getPropertyValue("z-index"),10)),!isNaN(a)&&n<a&&(n=a);return n+1}return function(e){var p,y,g,m,f,v,B,w,t,n,a,b=this,i=d++,E=e||{},s=1;function S(){(B=document.createElement("div")).setAttribute("id","playingField"),B.className="snake-playing-field",SNAKE.addEventListener(B,"click",function(){v.focus()},!1),(w=document.createElement("div")).className="snake-panel-component",w.innerHTML="Score: 0",t=function(){var e=document.createElement("div");e.id="sbWelcome"+i,e.className="snake-dialog snake-welcome-dialog";var t=document.createElement("p");t.innerHTML="Use arrow keys or swipes to play the game.";var n=document.createElement("button");n.appendChild(document.createTextNode("Play"));function a(){SNAKE.removeEventListener(window,"keyup",o,!1),e.style.display="none",b.setBoardState(1),b.getBoardContainer().focus()}var o=function(e){var t=(e=e||window.event).which?e.which:e.keyCode;32!==t&&13!==t||a()};return SNAKE.addEventListener(window,"keyup",o,!1),SNAKE.addEventListener(n,"click",a,!1),e.appendChild(t),e.appendChild(n),e}(),n=o("You died!","sbTryAgain","snake-dialog snake-try-again-dialog"),a=o("You won!","sbWin","snake-dialog snake-win-dialog"),SNAKE.addEventListener(v,"keyup",function(e){return(e=e||window.event).cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},!1),v.className="snake-game-container",v.appendChild(B),v.appendChild(w),v.appendChild(t),v.appendChild(n),v.appendChild(a),y=new SNAKE.Snake({playingBoard:b,startRow:2,startCol:2}),p=new SNAKE.Food({playingBoard:b}),t.style.zIndex=1e3}function o(e,t,n){var a=document.createElement("div");a.id=t+i,a.className=n;var o=document.createElement("p");o.innerHTML=e;var l=document.createElement("button");l.appendChild(document.createTextNode("Play again"));function d(){a.style.display="none",b.resetBoard(),b.setBoardState(1),b.getBoardContainer().focus()}return SNAKE.addEventListener(window,"keyup",function(e){var t;0===s&&"block"===a.style.display&&(32!==(t=(e=e||window.event).which?e.which:e.keyCode)&&13!==t||d())},!0),SNAKE.addEventListener(l,"click",d,!1),a.appendChild(o),a.appendChild(l),a}function l(e){var t=Math.max(r(y.snakeBody),r({tmp:{elm:p.getFoodElement()}}));v.removeChild(e),v.appendChild(e),e.style.zIndex=t,e.style.display="block",b.setBoardState(0)}function N(){SNAKE.addEventListener(v,"keydown",g,!1)}function H(){SNAKE.addEventListener(v,"touchstart",m,{passive:!0}),SNAKE.addEventListener(v,"touchmove",f,{passive:!0})}function x(){SNAKE.removeEventListener(v,"keydown",g,!1)}function C(){SNAKE.removeEventListener(v,"touchstart",m,{passive:!0}),SNAKE.removeEventListener(v,"touchmove",f,{passive:!0})}b.grid=[],b.resetBoard=function(){x(),C(),y.reset(),w.innerHTML="Score: 0",b.setupPlayingField()},b.getBoardState=function(){return s},b.setBoardState=function(e){s=e},b.getGridFoodValue=function(){return-1},b.getPlayingFieldElement=function(){return B},b.setBoardContainer=function(e){"string"==typeof e&&(e=document.getElementById(e)),e!==v&&(v=e,B=null,b.setupPlayingField())},b.getBoardContainer=function(){return v},b.getBlockWidth=function(){return 20},b.getBlockHeight=function(){return 20},b.setupPlayingField=function(){var e,t,n,a;B||S(),t=!0===E.fullScreen?(a=n=0,e=window.innerWidth,window.innerHeight):(n=E.top,a=E.left,e=E.width,E.height);var o=2*b.getBlockWidth()+e%b.getBlockWidth(),l=Math.min(250*b.getBlockWidth()-o,e-o),d=3*b.getBlockHeight()+t%b.getBlockHeight(),i=Math.min(250*b.getBlockHeight()-d,t-d);v.style.left=a+"px",v.style.top=n+"px",v.style.width=e+"px",v.style.height=t+"px",B.style.left=b.getBlockWidth()+"px",B.style.top=b.getBlockHeight()+"px",B.style.width=l+"px",B.style.height=i+"px";var s=d-b.getBlockHeight(),r=b.getBlockHeight()+i+Math.round((s-30)/2)+"px";w.style.top=r,b.grid=[];for(var c=l/b.getBlockWidth()+2,u=i/b.getBlockHeight()+2,h=0;h<u;h++){b.grid[h]=[];for(var k=0;k<c;k++)b.grid[h][k]=0===k||0===h||k===c-1||h===u-1?1:0}p.randomlyPlaceFood(),g=function(e){var t=(e=e||window.event).which?e.which:e.keyCode;if(1===b.getBoardState()){if(!(37<=t&&t<=40)&&87!==t&&65!==t&&83!==t&&68!==t)return;x(),g=function(e){var t=(e=e||window.event).which?e.which:e.keyCode;return y.handleArrowKeys(t),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},N(),y.rebirth(),y.handleArrowKeys(t),b.setBoardState(2),y.go()}return e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},f=function(e){return 1===b.getBoardState()&&(C(),f=function(e){e=e||window.event,y.handleTouchmove(e)},m=function(e){e=e||window.event,y.handleTouchstart(e)},H(),y.rebirth(),y.handleTouchmove(e),b.setBoardState(2),y.go()),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},N(),H()},b.foodEaten=function(){return w.innerHTML="Score: "+y.snakeLength,!!p.randomlyPlaceFood()},b.handleDeath=function(){l(n)},b.handleWin=function(){l(a)},E.fullScreen=void 0!==E.fullScreen&&E.fullScreen,E.top=void 0===E.top?0:E.top,E.left=void 0===E.left?0:E.left,E.width=void 0===E.width?400:E.width,E.height=void 0===E.height?400:E.height,E.fullScreen&&SNAKE.addEventListener(window,"resize",function(){b.setupPlayingField()},!1),b.setBoardState(0),E.boardContainer&&b.setBoardContainer(E.boardContainer)}}();